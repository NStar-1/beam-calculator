<div
  bind:this={element}
  use:useActions={use}
  use:forwardEvents
  class={classMap({
    [className]: true,
    'smui-accordion': true,
    'smui-accordion--multiple': multiple,
    'smui-accordion--with-open-dialog': withOpenDialog,
  })}
  on:SMUIAccordionPanel:mount={handlePanelMount}
  on:SMUIAccordionPanel:unmount={handlePanelUnmount}
  on:SMUIAccordionPanel:activate={handlePanelActivate}
  on:SMUIAccordionPanel:opening={handlePanelOpening}
  on:SMUIDialog:opening|capture={() => (withOpenDialog = true)}
  on:SMUIDialog:closed|capture={() => (withOpenDialog = false)}
  {...$$restProps}
>
  <slot />
</div>

<script>import { get_current_component } from 'svelte/internal';
import { forwardEventsBuilder, classMap, useActions, } from '@smui/common/internal';
const forwardEvents = forwardEventsBuilder(get_current_component());
// Remember to update $$Props if you add/remove/rename props.
export let use = [];
let className = '';
export { className as class };
export let multiple = false;
let element;
let panelAccessorSet = new Set();
let withOpenDialog = false;
function handlePanelMount(event) {
    const accessor = event.detail;
    // Stop propagation so accordion's above this one don't receive the event.
    event.stopPropagation();
    if (!multiple && accessor.open) {
        const currentOpen = Array.from(panelAccessorSet).find((accessor) => accessor.open);
        if (currentOpen) {
            currentOpen.setOpen(false);
        }
    }
    panelAccessorSet.add(accessor);
}
function handlePanelUnmount(event) {
    const accessor = event.detail;
    // Nested check.
    if (!panelAccessorSet.has(accessor)) {
        return;
    }
    // Stop propagation so accordion's above this one don't receive the event.
    event.stopPropagation();
    panelAccessorSet.delete(accessor);
}
function handlePanelActivate(event) {
    const { accessor } = event.detail;
    // Nested check.
    if (!panelAccessorSet.has(accessor)) {
        return;
    }
    if (!multiple && !accessor.open) {
        const currentOpen = Array.from(panelAccessorSet).find((accessor) => accessor.open);
        if (currentOpen) {
            currentOpen.setOpen(false);
        }
    }
    accessor.setOpen(!accessor.open);
}
function handlePanelOpening(event) {
    const { accessor } = event.detail;
    // Nested check.
    if (!panelAccessorSet.has(accessor)) {
        return;
    }
    if (!multiple) {
        const otherOpen = Array.from(panelAccessorSet).filter((checkAccessor) => checkAccessor !== accessor && checkAccessor.open);
        otherOpen.forEach((accessor) => accessor.setOpen(false));
    }
}
export function getElement() {
    return element;
}
</script>
