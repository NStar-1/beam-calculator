<MenuSurface
  bind:this={element}
  use={usePass}
  class={classMap({
    [className]: true,
    'mdc-menu': true,
  })}
  bind:open
  on:SMUIMenuSurface:mount={handleMenuSurfaceAccessor}
  on:SMUIList:mount={handleListAccessor}
  on:SMUIMenuSurface:opened={() =>
    instance && instance.handleMenuSurfaceOpened()}
  on:keydown={handleKeydown}
  on:SMUIList:action={(event) =>
    instance &&
    instance.handleItemAction(
      listAccessor.getOrderedList()[event.detail.index].element
    )}
  {...$$restProps}><slot /></MenuSurface
>

<script>import { MDCMenuFoundation, cssClasses } from '@material/menu';
import { ponyfill } from '@material/dom';
import { onMount } from 'svelte';
import { get_current_component } from 'svelte/internal';
import { forwardEventsBuilder, classMap, dispatch, } from '@smui/common/internal';
import MenuSurface from '@smui/menu-surface';
const { closest } = ponyfill;
const forwardEvents = forwardEventsBuilder(get_current_component());
export let use = [];
$: usePass = [forwardEvents, ...use];
let className = '';
export { className as class };
export let open = false;
let element;
let instance;
let menuSurfaceAccessor;
let listAccessor;
onMount(() => {
    instance = new MDCMenuFoundation({
        addClassToElementAtIndex: (index, className) => {
            listAccessor.addClassForElementIndex(index, className);
        },
        removeClassFromElementAtIndex: (index, className) => {
            listAccessor.removeClassForElementIndex(index, className);
        },
        addAttributeToElementAtIndex: (index, attr, value) => {
            listAccessor.setAttributeForElementIndex(index, attr, value);
        },
        removeAttributeFromElementAtIndex: (index, attr) => {
            listAccessor.removeAttributeForElementIndex(index, attr);
        },
        getAttributeFromElementAtIndex: (index, attr) => listAccessor.getAttributeFromElementIndex(index, attr),
        elementContainsClass: (element, className) => element.classList.contains(className),
        closeSurface: (skipRestoreFocus) => menuSurfaceAccessor.closeProgrammatic(skipRestoreFocus),
        getElementIndex: (element) => listAccessor
            .getOrderedList()
            .map((accessor) => accessor.element)
            .indexOf(element),
        notifySelected: (evtData) => dispatch(getElement(), 'SMUIMenu:selected', {
            index: evtData.index,
            item: listAccessor.getOrderedList()[evtData.index].element,
        }, undefined, true),
        getMenuItemCount: () => listAccessor.items.length,
        focusItemAtIndex: (index) => listAccessor.focusItemAtIndex(index),
        focusListRoot: () => 'focus' in listAccessor.element &&
            listAccessor.element.focus(),
        isSelectableItemAtIndex: (index) => !!closest(listAccessor.getOrderedList()[index].element, `.${cssClasses.MENU_SELECTION_GROUP}`),
        getSelectedSiblingOfItemAtIndex: (index) => {
            const orderedList = listAccessor.getOrderedList();
            const selectionGroupEl = closest(orderedList[index].element, `.${cssClasses.MENU_SELECTION_GROUP}`);
            const selectedItemEl = selectionGroupEl === null || selectionGroupEl === void 0 ? void 0 : selectionGroupEl.querySelector(`.${cssClasses.MENU_SELECTED_LIST_ITEM}`);
            return selectedItemEl
                ? orderedList.map((item) => item.element).indexOf(selectedItemEl)
                : -1;
        },
    });
    dispatch(getElement(), 'SMUIMenu:mount', instance);
    instance.init();
    return () => {
        instance.destroy();
    };
});
function handleKeydown(event) {
    instance && instance.handleKeydown(event);
}
function handleMenuSurfaceAccessor(event) {
    if (!menuSurfaceAccessor) {
        menuSurfaceAccessor = event.detail;
    }
}
function handleListAccessor(event) {
    if (!listAccessor) {
        listAccessor = event.detail;
    }
}
export function isOpen() {
    return open;
}
export function setOpen(value) {
    open = value;
}
export function setDefaultFocusState(focusState) {
    instance.setDefaultFocusState(focusState);
}
export function getSelectedIndex() {
    return instance.getSelectedIndex();
}
export function getMenuSurface() {
    return element;
}
export function getElement() {
    return element.getElement();
}
</script>
